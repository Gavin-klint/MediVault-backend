{% extends 'base.html' %}
{% block content %}

<h1 class="section-title">My Medical Records</h1>

<div class="card">
    <h3 style="margin-top:0; border-bottom:1px solid #333; padding-bottom:12px; font-size:16px; color:#888;">UPLOAD NEW RECORD</h3>
    
    <form action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data" style="margin-top:24px; display:flex; gap:16px; align-items:center; flex-wrap:wrap;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <input type="file" name="file" required style="flex:2; min-width:200px;">
        
        <input type="password" name="auth_pin" placeholder="CONFIRM PIN" maxlength="4" required style="flex:1; min-width:120px; text-align:center;">
        
        <button style="flex:1; min-width:150px; background:#002200; border-color:#004400; color:#44ff44;">ENCRYPT & UPLOAD</button>
    </form>
</div>

<div style="margin-top:48px; border-top:1px solid #222;"></div>

{% for file in files %}
<div style="display:flex; justify-content:space-between; align-items:center; padding:24px 0; border-bottom:1px solid #111;">
    <div>
        <div style="font-size:18px; font-weight:500; color:#fff;">{{ file.filename }}</div>
        <div class="muted">UPLOADED: {{ file.upload_date.strftime('%Y-%m-%d') }}</div>
    </div>

    <div style="display:flex; gap:16px; align-items:center;">
        
        <form action="{{ url_for('verify_view', file_id=file.id) }}" method="POST" style="display:flex; gap:12px;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="password" name="pin_attempt" placeholder="PIN" maxlength="4" required style="width:100px; text-align:center;">
            <button>VIEW</button>
        </form>

        <form action="{{ url_for('delete_file', file_id=file.id) }}" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button style="border-color:#550000; color:#ff4444;" onclick="return confirm('Permanently delete this file?')">DELETE</button>
        </form>
    </div>
</div>
{% else %}
<div style="padding:48px 0; text-align:center; color:#444;">
    NO RECORDS FOUND IN VAULT.
</div>
{% endfor %}

{% endblock %}